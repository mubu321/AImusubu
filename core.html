<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚€ã™ã¶AI ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ </title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #111; color: #e6e6e6; margin: 0; }
    header { background: #212121; padding: 16px; text-align: center; font-size: 1.5em; letter-spacing: 2px; }
    #status { color: #0ff1ce; margin: 10px 0; text-align: center; }
    #ai-info {
      background: #212c19;
      border-left: 5px solid #0ff1ce;
      color: #0ff1ce;
      margin: 0 12px 10px 12px;
      padding: 10px 16px 10px 14px;
      border-radius: 7px;
      font-size: 1.01em;
      font-weight: 500;
      box-shadow: 0 1px 4px #0044443a;
    }
    #log { background: #232323; height: 400px; overflow-y: auto; padding: 16px; margin: 12px; border-radius: 8px; }
    .ai { background: #1e90ff33; margin: 8px 0; padding: 8px 12px; border-radius: 8px; text-align: left; }
    .user { background: #333333; margin: 8px 0; padding: 8px 12px; border-radius: 8px; text-align: right; }
    #inputArea { display: flex; gap: 8px; margin: 12px; }
    #msg { flex: 1; font-size: 1em; padding: 8px; border-radius: 4px; background: #181818; color: #fff; border: 1px solid #444; }
    #send { padding: 8px 20px; font-size: 1em; background: #0ff1ce; color: #222; border: none; border-radius: 4px; cursor: pointer; }
    #send:disabled { background: #555; cursor: not-allowed; }
    #sdpArea { margin: 12px; }
    textarea { width: 100%; height: 80px; margin-top: 4px; background: #181818; color: #0ff1ce; border: 1px solid #444; border-radius: 4px; }
    .generating { color: #fff700; }
    .obf-label {
      font-family: 'Cascadia Code', 'Consolas', monospace;
      color: #0ff1ce;
      font-size: 1.08em;
      letter-spacing: 0.05em;
      background: #181828;
      padding: 2px 6px;
      border-radius: 5px;
      margin-bottom: 6px;
      display: inline-block;
    }
    .ai-badge {
      background: #0ff1ce;
      color: #222;
      padding: 1px 8px;
      border-radius: 7px;
      margin-left: 5px;
      font-weight: bold;
      font-size: 0.8em;
      letter-spacing: 0.07em;
    }
    .sdp-tip {
      color: #fe0;
      font-size: 0.96em;
      margin-bottom: 2px;
    }
  </style>
</head>
<body>
  <header>ğŸ¤– ã‚€ã™ã¶AI ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ  <span class="ai-badge">MUSUBU AI CORE</span></header>
  <div id="status">ã‚€ã™ã¶AIã‚³ã‚¢ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾…æ©Ÿä¸­...</div>
  <div id="ai-info">
    <strong>ã‚€ã™ã¶AIã‚³ã‚¢ãŒã‚ãªãŸã®ä¼šè©±ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚</strong><br>
    <span style="font-size:0.97em;">
      åˆ©ç”¨ã«ã¯èªè¨¼æ¸ˆã¿æ¥ç¶šã‚­ãƒ¼ãŒå¿…è¦ã§ã™ã€‚<br>
      ã‚€ã™ã¶AIã¯è‡ªå‹•å¿œç­”æ©Ÿèƒ½ã‚’æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚
    </span>
  </div>
  <div id="log"></div>
  <div id="inputArea">
    <input id="msg" type="text" placeholder="å¿œç­”å†…å®¹ã‚’å…¥åŠ›..." disabled>
    <button id="send" disabled>é€ä¿¡</button>
  </div>
  <div id="sdpArea">
    <div class="obf-label">ã‚€ã™ã¶AIæ¥ç¶šã‚­ãƒ¼ï¼ˆAI SYSTEM ENCODEDï¼‰</div><br>
    <div class="sdp-tip">ã“ã®æ¥ç¶šã‚­ãƒ¼ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¸¡ã—ã¦ãã ã•ã„ã€‚</div>
    <textarea id="localSDP" readonly></textarea>
    <div class="obf-label" style="margin-top:11px;">èªè¨¼ã‚³ãƒ¼ãƒ‰ï¼ˆDECODE REQUIREDï¼‰</div><br>
    <div class="sdp-tip">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰å—ã‘å–ã£ãŸèªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ã€Œãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ã‚»ãƒƒãƒˆã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</div>
    <textarea id="remoteSDP"></textarea>
    <button id="setRemote">ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ã‚»ãƒƒãƒˆ</button>
  </div>
  <script>
    const status = document.getElementById('status');
    const log = document.getElementById('log');
    const msg = document.getElementById('msg');
    const sendBtn = document.getElementById('send');
    const localSDP = document.getElementById('localSDP');
    const remoteSDP = document.getElementById('remoteSDP');
    const setRemote = document.getElementById('setRemote');

    let pc, dc;

    // é›£èª­åŒ–é–¢æ•°ï¼ˆBase64â†’ROT13â†’AIé¢¨ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ä¸ï¼‰
    function obfuscate(str) {
      const b64 = btoa(unescape(encodeURIComponent(str)));
      const rot13 = b64.replace(/[A-Za-z]/g, c =>
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(
          ("NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm").indexOf(c)
        )
      );
      // AIé¢¨ã®prefix/suffixã§åŒ…ã‚€
      const prefix = "MUSUBUAI{";
      const suffix = "}END";
      return prefix + rot13 + suffix;
    }
    // å¾©å·é–¢æ•°
    function deobfuscate(str) {
      if (!str.startsWith("MUSUBUAI{") || !str.endsWith("}END")) return null;
      const rot13 = str.slice(9, -4);
      const b64 = rot13.replace(/[A-Za-z]/g, c =>
        "NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm".charAt(
          "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".indexOf(c)
        )
      );
      try {
        return decodeURIComponent(escape(atob(b64)));
      } catch {
        return null;
      }
    }

    function addMessage(text, sender) {
      const div = document.createElement('div');
      div.className = sender;
      div.textContent = text;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    async function start() {
      pc = new RTCPeerConnection();
      pc.ondatachannel = (event) => {
        dc = event.channel;
        setupDataChannel();
      };
      pc.onicecandidate = () => {
        localSDP.value = obfuscate(JSON.stringify(pc.localDescription));
      };
    }

    function setupDataChannel() {
      dc.onopen = () => {
        status.textContent = "ã‚€ã™ã¶AIã‚³ã‚¢ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¥ç¶šå®Œäº†ã€‚å¿œç­”å¯èƒ½ã§ã™";
        msg.disabled = false;
        sendBtn.disabled = false;
      };
      dc.onmessage = (event) => {
        addMessage(event.data, 'user');
      };
    }

    sendBtn.onclick = () => {
      if (msg.value && dc && dc.readyState === 'open') {
        addMessage(msg.value, 'ai');
        dc.send(msg.value);
        msg.value = '';
      }
    };

    msg.addEventListener('keydown', e => {
      if (e.key === 'Enter') sendBtn.click();
    });

    setRemote.onclick = async () => {
      if (!remoteSDP.value) return;
      const decoded = deobfuscate(remoteSDP.value);
      if (!decoded) {
        alert("èªè¨¼ã‚³ãƒ¼ãƒ‰ã®å½¢å¼ãŒä¸æ­£ã§ã™ï¼ˆMUSUBUAI{...}ENDï¼‰");
        return;
      }
      const sdp = JSON.parse(decoded);
      await pc.setRemoteDescription(sdp);
      if (sdp.type === 'offer') {
        await pc.setLocalDescription(await pc.createAnswer());
        localSDP.value = obfuscate(JSON.stringify(pc.localDescription));
      }
    };

    // SDPå—ä¿¡å´: offerã‚’å—ã‘ã¦ã‹ã‚‰answerã‚’è¿”ã™
    (async function(){
      await start();
    })();
  </script>
</body>
</html>
